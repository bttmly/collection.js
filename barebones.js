// Generated by CoffeeScript 1.6.3
(function() {
  "use strict";
  var factory,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  factory = function(root, Barebones, _) {
    var Collection, Model, array, attributeMethods, collectionMethods, lib, nativeMethods, push, returnsCollectionMethods, slice, splice, unshift;
    lib = _.noop ? "lodash" : "underscore";
    array = [];
    push = array.push;
    slice = array.slice;
    splice = array.splice;
    unshift = array.unshift;
    Model = (function() {
      function Model(model) {
        var prop, val;
        for (prop in model) {
          val = model[prop];
          this[prop] = val;
        }
      }

      return Model;

    })();
    Collection = (function(_super) {
      __extends(Collection, _super);

      function Collection(models, options) {
        options || (options = {});
        this.model = options.model || this.model;
        this.initialize.apply(this, arguments);
      }

      Collection.prototype.model = Model;

      Collection.prototype.initialize = function(models, options) {
        var model, _i, _len, _results;
        if (models) {
          _results = [];
          for (_i = 0, _len = models.length; _i < _len; _i++) {
            model = models[_i];
            _results.push(this.push(model));
          }
          return _results;
        }
      };

      Collection.prototype.push = function(model) {
        return Collection.__super__.push.call(this, this._prepareModel(model));
      };

      Collection.prototype.unshift = function(model) {
        return Collection.__super__.unshift.call(this, this._prepareModel(model));
      };

      Collection.prototype.concat = function() {
        var model, models, _i, _len;
        models = [].concat([].slice.call(arguments));
        for (_i = 0, _len = models.length; _i < _len; _i++) {
          model = models[_i];
          model = this._prepareModel(model);
        }
        return Collection.__super__.concat.call(this, models);
      };

      Collection.prototype.arrayify = function() {
        var model, obj, prop, results, val, _i, _len;
        results = [];
        for (_i = 0, _len = this.length; _i < _len; _i++) {
          model = this[_i];
          obj = new Object;
          for (prop in model) {
            val = model[prop];
            obj[prop] = val;
          }
          results.push(obj);
        }
        return results;
      };

      Collection.prototype._prepareModel = function(model) {
        if (!(model instanceof this.model)) {
          model = new this.model(model);
        }
        return model;
      };

      return Collection;

    })(Array);
    collectionMethods = ['forEach', 'each', 'map', 'collect', 'reduce', 'foldl', 'inject', 'reduceRight', 'foldr', 'find', 'detect', 'filter', 'select', 'reject', 'every', 'all', 'some', 'any', 'include', 'contains', 'invoke', 'max', 'min', 'toArray', 'size', 'first', 'head', 'take', 'initial', 'rest', 'tail', 'drop', 'last', 'without', 'indexOf', 'shuffle', 'lastIndexOf', 'isEmpty', 'chain'];
    collectionMethods = collectionMethods.concat('pluck', 'where', 'findWhere');
    if (lib === "lodash") {
      collectionMethods = collectionMethods.concat('at', 'eachRight', 'forEachRight', 'findLast');
    }
    _.each(collectionMethods, function(method) {
      Collection.prototype[method] = function() {
        var args;
        args = [].slice.call(arguments);
        args.unshift(this);
        return _[method].apply(_, args);
      };
    });
    attributeMethods = ['groupBy', 'countBy', 'sortBy', 'indexBy'];
    _.each(attributeMethods, function(method) {
      Collection.prototype[method] = function(value, context) {
        var iterator;
        iterator = _.isFunction(value) ? value : function(model) {
          return model[value];
        };
        return _[method](this, iterator, context);
      };
    });
    nativeMethods = ['slice', 'splice', 'shift', 'pop', 'join', 'reverse', 'sort'];
    _.each(nativeMethods, function(method) {
      Collection.prototype[method] = function() {
        var args;
        args = [].slice.call(arguments);
        args.unshift(this);
        return [][method].apply(this, arguments);
      };
    });
    returnsCollectionMethods = ['filter', 'where', 'reject'];
    _.each(returnsCollectionMethods, function(method) {
      var methodName;
      methodName = "col" + method.charAt(0).toUpperCase() + method.slice(1);
      Collection.prototype[methodName] = function() {
        var args, collection, constructor;
        constructor = Object.getPrototypeOf(this).constructor;
        args = [].slice.call(arguments);
        args.unshift(this);
        collection = _[method].apply(_, args);
        return new constructor(collection);
      };
    });
    return {
      Model: Model,
      Collection: Collection
    };
  };

  (function(root, factory) {
    var _;
    if (typeof define === "function" && define.amd) {
      define(["underscore", "exports"], function(_, exports) {
        root.Barebones = factory(root, exports, _);
      });
    } else if (typeof exports !== "undefined") {
      _ = require("lodash") || require("underscore");
      factory(root, exports, _);
    } else {
      root.Barebones = factory(root, {}, root._);
    }
  })(this, factory);

}).call(this);
